<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="me.zhengjie.modules.courseTimeInfo.service.mapper.CourseTimeInfoMapper">

  <!-- 通用查询结果列 -->
  <!--
  <sql id="Base_Column_List">
      a.timeid, a.cid, a.week, a.day, a.trap, a.adress
  </sql>
  -->
  <select id="findCourseNameById" parameterType="java.lang.Integer" resultType="String">
    select cname from course where cid = #{id}
  </select>

  <select id="findTeacherNameById" parameterType="java.lang.Integer" resultType="String">
    select tname from teacher where tid = #{id}
  </select>

  <select id="findOldWeekById" parameterType="java.lang.Integer" resultType="String">
    select week from course_time_info where timeid = #{id}
  </select>

  <select id="findOldDayById" parameterType="java.lang.Integer" resultType="String">
    select day from course_time_info where timeid = #{id}
  </select>

  <select id="findOldTrapById" parameterType="java.lang.Integer" resultType="String">
    select trap from course_time_info where timeid = #{id}
  </select>

  <select id="findOldAddressById" parameterType="java.lang.Integer" resultType="String">
    select adress from course_time_info where timeid = #{id}
  </select>

  <select id="findCourseIdByTimeId" parameterType="java.lang.Integer" resultType="java.lang.Integer">
    select cid from course_time_info where timeid = #{id}
  </select>

  <select id="getCourseInfo" resultType="me.zhengjie.modules.course.domain.Course">
    SELECT * from course
  </select>

  <select id="getStudentCourseInfo" parameterType="java.lang.String" resultType="me.zhengjie.modules.courseTimeInfo.service.dto.CourseTimeInfoDto">
    select cname,tname,week,day,trap,adress from
    ( select cname,tid,tmp.* from
    (select * from course_time_info where cid in (select cid from course_student_info where sid = #{id})) tmp join course on tmp.cid=course.cid) tmp2
     join teacher on tmp2.tid = teacher.tid order by week,day,trap
  </select>

  <select id="getStudentCourseWeek" parameterType="java.lang.String" resultType="me.zhengjie.modules.courseTimeInfo.service.dto.CourseTimeInfoDto">
    select DISTINCT week from
        (select cid from course_student_info where sid = #{id}) tmp join course_time_info on tmp.cid = course_time_info.cid
  </select>

  <select id="getStudentCourseInfoByWeek" resultType="me.zhengjie.modules.courseTimeInfo.service.dto.CourseTimeInfoDto">
    select cname,tname,week,day,trap,adress from
      ( select cname,tid,tmp.* from
      (select * from course_time_info where cid in (select cid from course_student_info where sid = #{id})) tmp join course on tmp.cid=course.cid) tmp2
      join teacher on tmp2.tid = teacher.tid where week = #{week} order by week,day,trap
  </select>

  <select id="getTeacherCourseInfo" parameterType="java.lang.String" resultType="me.zhengjie.modules.courseTimeInfo.service.dto.CourseTimeInfoDto">
    select timeid,cname,week,day,trap,adress from
      (select timeid,cid,week,day,trap,adress from course_time_info where cid in
      (select cid from course where tid = #{id})) tmp join course on tmp.cid = course.cid order by week,day,trap
  </select>

  <select id="getTeacherCourseWeek" parameterType="java.lang.String" resultType="me.zhengjie.modules.courseTimeInfo.service.dto.CourseTimeInfoDto">
    select distinct week from course_time_info where cid in (select cid from course where tid = #{id})
  </select>

  <select id="getTeacherCourseInfoByWeek" resultType="me.zhengjie.modules.courseTimeInfo.service.dto.CourseTimeInfoDto">
    select timeid,cname,week,day,trap,adress from
      (select * from course_time_info where cid in
      (select cid from course where tid = #{id}) and week = #{week}) tmp join course on tmp.cid = course.cid order by week,day,trap
  </select>

  <update id="updateCourseInfo">
    update course_time_info set week = #{week},day = #{day},trap = #{trap},adress = #{address} where timeid = #{timeid}
  </update>

  <insert id="insertMessageInfo">
    insert into message(title,content,createtime,status,author) values (#{title},#{content},#{createtime},1,#{author})
  </insert>
</mapper>
